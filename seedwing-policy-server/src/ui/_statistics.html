
{{#> layout }}
<style>
</style>

<table
    class="pf-c-table pf-m-grid-md pf-m-compact"
    role="grid"
    aria-label="This is a simple table example"
    id="statistics"
>
  <thead>
  <tr role="row">
    <th role="columnheader" scope="col">Pattern</th>
    <th role="columnheader" scope="col">Total</th>
    <th role="columnheader" scope="col">Satisfied</th>
    <th role="columnheader" scope="col">Unsatisfied</th>
    <th role="columnheader" scope="col">Error</th>
    <th role="columnheader" scope="col">Mean</th>
    <th role="columnheader" scope="col">Median</th>
    <th role="columnheader" scope="col">StdDev</th>
  </tr>
  </thead>

  <tbody role="rowgroup">
  </tbody>
</table>

<script defer>

  function update() {
    $.getJSON( ".", function(data) {
      data.forEach( function(stats) {
        let row_id = stats.name.replaceAll("::", "_");
        var row = $("<tr id='" + row_id + "'>")
          .append(
            $("<td class='name'>").text( stats.name )
          )
          .append(
            $("<td>").text( stats.invocations )
          )
          .append(
            $("<td>").text( stats.satisfied_invocations )
          )
          .append(
            $("<td>").text( stats.unsatisfied_invocations )
          )
          .append(
            $("<td>").text( stats.error_invocations )
          )
          .append(
            $("<td>").text( stats.mean )
          )
          .append(
            $("<td>").text( stats.median )
          )
          .append(
            $("<td>").text( stats.stddev )
          );
        var existing_row = $("#" + row_id);
        if (existing_row.length) {
          existing_row.replaceWith( row )
        } else {
          $("#statistics tbody").append( row );
        }

        // now do a basic sort

        var table_data = $('#statistics').find('tbody >tr:has(td)').get();
        table_data.sort( function(l,r) {
          var l_val = $(l).children('.name').text();
          var r_val = $(r).children('.name').text();
          if (l_val < r_val) {
            return -1;
          } else if (l_val > r_val) {
            return 1;
          } else {
            return 0;
          }
        });
        $.each(table_data, function(index, row) {
          $("#statistics tbody").append(row);
        } );
      } );
    } );
    setTimeout( update, 2000);
  }
  update();
</script>

{{/layout}}